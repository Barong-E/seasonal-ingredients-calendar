import{L as m}from"./main-DThI6SoP.js";import"./style-CgXtxQZB.js";const e={ingredient:{enabled:!1,day:1,time:"09:00"},holiday:{enabled:!1,dDay:3,time:"09:00"}};async function w(){const n=localStorage.getItem("app_settings");if(n){const l=JSON.parse(n);e.ingredient={...e.ingredient,...l.ingredient},e.holiday={...e.holiday,...l.holiday}}return e}async function b(n){e.ingredient=n.ingredient,e.holiday=n.holiday,localStorage.setItem("app_settings",JSON.stringify(e)),await S()}function v(){const n=document.getElementById("settingModal"),l=n.querySelector(".modal__close"),s=n.querySelector(".modal__backdrop"),c=document.getElementById("ingredientNotiToggle"),r=document.getElementById("ingredientNotiDetail"),o=document.getElementById("ingredientNotiDay"),i=document.getElementById("ingredientNotiTime"),t=document.getElementById("holidayNotiToggle"),g=document.getElementById("holidayNotiDetail"),a=document.getElementById("holidayNotiDday"),h=document.getElementById("holidayNotiTime"),y=document.getElementById("saveSettingButton");for(let d=1;d<=31;d++){const u=document.createElement("option");u.value=d,u.textContent=`Îß§Ïõî ${d}Ïùº`,o.appendChild(u)}w().then(()=>{c.checked=e.ingredient.enabled,r.style.display=e.ingredient.enabled?"block":"none",o.value=e.ingredient.day,i.value=e.ingredient.time||"09:00",t.checked=e.holiday.enabled,g.style.display=e.holiday.enabled?"block":"none",a.value=e.holiday.dDay,h.value=e.holiday.time||"09:00"}),c.addEventListener("change",d=>{r.style.display=d.target.checked?"block":"none"}),t.addEventListener("change",d=>{g.style.display=d.target.checked?"block":"none"}),y.addEventListener("click",async()=>{const d={ingredient:{enabled:c.checked,day:parseInt(o.value),time:i.value||"09:00"},holiday:{enabled:t.checked,dDay:parseInt(a.value),time:h.value||"09:00"}};try{await b(d),closeSettingModal(),alert("ÏÑ§Ï†ïÏù¥ Ï†ÄÏû•ÎêòÍ≥† ÏïåÎ¶ºÏù¥ ÏòàÏïΩÎêòÏóàÏäµÎãàÎã§.")}catch(u){console.error("ÏïåÎ¶º ÏÑ§Ï†ï Ï†ÄÏû• Ïã§Ìå®:",u),alert(`ÏïåÎ¶º Í∂åÌïúÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.
Í∏∞Í∏∞ ÏÑ§Ï†ïÏóêÏÑú ÏïåÎ¶ºÏùÑ ÌóàÏö©Ìï¥Ï£ºÏÑ∏Ïöî.`)}});const p=()=>{n.setAttribute("aria-hidden","true"),n.style.display="none",document.body.style.overflow=""};l.addEventListener("click",p),s.addEventListener("click",p),window.openSettingModal=()=>{history.pushState({modal:"setting"},"",location.href),n.setAttribute("aria-hidden","false"),n.style.display="flex",document.body.style.overflow="hidden"},window.closeSettingModal=p}async function S(){if((await m.checkPermissions()).display!=="granted"&&(await m.requestPermissions()).display!=="granted")throw console.error("LocalNotifications Í∂åÌïúÏù¥ Í±∞Î∂ÄÎêòÏóàÏäµÎãàÎã§."),new Error("ÏïåÎ¶º Í∂åÌïúÏù¥ ÌïÑÏöîÌï©ÎãàÎã§.");try{await m.createChannel({id:"default",name:"Í∏∞Î≥∏ ÏïåÎ¶º",description:"Ï†úÏ≤† ÏïåÎ¶¨ÎØ∏ Î°úÏª¨ ÏïåÎ¶º",importance:4,visibility:1,sound:"default"}),console.log("LocalNotifications Ï±ÑÎÑê ÏÉùÏÑ± ÏôÑÎ£å")}catch(o){console.warn("Ï±ÑÎÑê ÏÉùÏÑ± Ïã§Ìå® (Ïù¥ÎØ∏ Ï°¥Ïû¨ÌïòÍ±∞ÎÇò Ïõπ ÌôòÍ≤Ω):",o)}const l=await m.getPending();l.notifications.length>0&&(await m.cancel(l),console.log(`Í∏∞Ï°¥ ÏïåÎ¶º ${l.notifications.length}Í∞ú Ï∑®ÏÜåÎê®`));const s=[],c=f(e.ingredient.time,{hours:9,minutes:0}),r=f(e.holiday.time,{hours:9,minutes:0});if(e.ingredient.enabled){const o=e.ingredient.day,i=new Date;for(let t=0;t<12;t++){const g=new Date(i.getFullYear(),i.getMonth()+t,o,c.hours,c.minutes,0);if(g.getMonth()!==(i.getMonth()+t)%12&&g.setDate(0),g<i)continue;const a=g.getMonth()+1,h=I(a);if(h.length>0){const y=h.slice(0,3).map(u=>u.name_ko).join(", "),p=h.length,d=p>3?`${y} Îì± ${p}Í∞ÄÏßÄÍ∞Ä Ï†úÏ≤†Ïù¥ÏóêÏöî.`:`${y}Ïù¥(Í∞Ä) Ï†úÏ≤†Ïù¥ÏóêÏöî.`;s.push({id:1e4+t,title:`${a}ÏõîÏùò Ï†úÏ≤† ÏãùÏû¨Î£å ü•¶`,body:`${a}ÏõîÏóêÎäî ${d}`,schedule:{at:g},extra:{type:"ingredient",month:a},channelId:"default",smallIcon:"ic_launcher"})}}}if(e.holiday.enabled){const o=e.holiday.dDay;(window.AppState?.holidays||[]).forEach((t,g)=>{if(!t.solarDate)return;const a=new Date(t.solarDate);if(a.setDate(a.getDate()-o),a.setHours(r.hours,r.minutes,0),a>new Date){const h=t.details?.foods?.slice(0,2).map(y=>y.name).join(", ")||"ÎßõÏûàÎäî ÏùåÏãù";s.push({id:2e4+g,title:`Í≥ß ${t.name}ÏûÖÎãàÎã§ üåï`,body:`${t.name}ÏóêÎäî ${h}ÏùÑ(Î•º) Î®πÏñ¥Ïöî.`,schedule:{at:a},extra:{type:"holiday",name:t.name},channelId:"default",smallIcon:"ic_launcher"})}})}if(s.length>0){await m.schedule({notifications:s}),console.log(`‚úÖ ${s.length}Í∞úÏùò ÏïåÎ¶ºÏù¥ ÏòàÏïΩÎêòÏóàÏäµÎãàÎã§.`),console.log("üìÖ ÏòàÏïΩÎêú ÏïåÎ¶º Î™©Î°ù:"),s.forEach(i=>{const t=new Date(i.schedule.at);console.log(`  - [${i.id}] ${i.title} | ${t.toLocaleString("ko-KR")}`)});const o=await m.getPending();console.log(`üìã ÏãúÏä§ÌÖúÏóê Îì±Î°ùÎêú ÏïåÎ¶º Ïàò: ${o.notifications.length}Í∞ú`)}else console.warn("‚ö†Ô∏è ÏòàÏïΩÌï† ÏïåÎ¶ºÏù¥ 0Í∞úÏûÖÎãàÎã§. (AppState.allIngredients ÎπÑÏñ¥ÏûàÍ±∞ÎÇò Ï°∞Í±¥ ÎØ∏Ï∂©Ï°±)"),console.log("  - AppState.allIngredients Í∏∏Ïù¥:",window.AppState?.allIngredients?.length||0),console.log("  - ÏãùÏû¨Î£å ÏïåÎ¶º ÌôúÏÑ±Ìôî:",e.ingredient.enabled),console.log("  - Î™ÖÏ†à ÏïåÎ¶º ÌôúÏÑ±Ìôî:",e.holiday.enabled)}function I(n){return(window.AppState?.allIngredients||[]).filter(s=>{const c=s.periods||[],r=c.some(t=>t.month===n);let o=n-1;o===0&&(o=12);const i=c.some(t=>t.month===o);return r&&!i})}function f(n,l){if(!n||typeof n!="string")return l;const[s,c]=n.split(":"),r=Number(s),o=Number(c);return Number.isNaN(r)||Number.isNaN(o)?l:{hours:r,minutes:o}}export{v as initSettingModal,w as loadSettings,b as saveSettings};
