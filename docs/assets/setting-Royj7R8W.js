import{L as m}from"./main-B3kA7os0.js";import"./style-DGAzWC-q.js";const t={ingredient:{enabled:!1,day:1},holiday:{enabled:!1,dDay:3}};async function u(){const e=localStorage.getItem("app_settings");if(e){const s=JSON.parse(e);t.ingredient={...t.ingredient,...s.ingredient},t.holiday={...t.holiday,...s.holiday}}return t}async function p(e){t.ingredient=e.ingredient,t.holiday=e.holiday,localStorage.setItem("app_settings",JSON.stringify(t)),await f()}function S(){const e=document.getElementById("settingModal"),s=e.querySelector(".modal__close"),c=e.querySelector(".modal__backdrop"),a=document.getElementById("ingredientNotiToggle"),n=document.getElementById("ingredientNotiDetail"),i=document.getElementById("ingredientNotiDay"),o=document.getElementById("holidayNotiToggle"),d=document.getElementById("holidayNotiDetail"),g=document.getElementById("holidayNotiDday"),y=document.getElementById("saveSettingButton");for(let l=1;l<=31;l++){const h=document.createElement("option");h.value=l,h.textContent=`ë§¤ì›” ${l}ì¼`,i.appendChild(h)}u().then(()=>{a.checked=t.ingredient.enabled,n.style.display=t.ingredient.enabled?"block":"none",i.value=t.ingredient.day,o.checked=t.holiday.enabled,d.style.display=t.holiday.enabled?"block":"none",g.value=t.holiday.dDay}),a.addEventListener("change",l=>{n.style.display=l.target.checked?"block":"none"}),o.addEventListener("change",l=>{d.style.display=l.target.checked?"block":"none"}),y.addEventListener("click",async()=>{const l={ingredient:{enabled:a.checked,day:parseInt(i.value)},holiday:{enabled:o.checked,dDay:parseInt(g.value)}};await p(l),closeSettingModal(),alert("ì„¤ì •ì´ ì €ìž¥ë˜ê³  ì•Œë¦¼ì´ ì˜ˆì•½ë˜ì—ˆìŠµë‹ˆë‹¤.")});const r=()=>{e.setAttribute("aria-hidden","true"),e.style.display="none",document.body.style.overflow=""};s.addEventListener("click",r),c.addEventListener("click",r),window.openSettingModal=()=>{e.setAttribute("aria-hidden","false"),e.style.display="flex",document.body.style.overflow="hidden"},window.closeSettingModal=r}async function f(){const e=await m.getPending();e.notifications.length>0&&await m.cancel(e);const s=[];if(t.ingredient.enabled){const c=t.ingredient.day,a=new Date;for(let n=0;n<12;n++){const i=new Date(a.getFullYear(),a.getMonth()+n,c,9,0,0);if(i.getMonth()!==(a.getMonth()+n)%12&&i.setDate(0),i<a)continue;const o=i.getMonth()+1,d=D(o);if(d.length>0){const g=d.slice(0,3).map(l=>l.name_ko).join(", "),y=d.length,r=y>3?`${g} ë“± ${y}ê°€ì§€ê°€ ì œì² ì´ì—ìš”.`:`${g}ì´(ê°€) ì œì² ì´ì—ìš”.`;s.push({id:1e4+n,title:`${o}ì›”ì˜ ì œì²  ì‹ìž¬ë£Œ ðŸ¥¦`,body:`${o}ì›”ì—ëŠ” ${r}`,schedule:{at:i},extra:{type:"ingredient",month:o},smallIcon:"ic_stat_icon_config_sample"})}}}if(t.holiday.enabled){const c=t.holiday.dDay;(window.AppState?.holidays||[]).forEach((n,i)=>{if(!n.solarDate)return;const o=new Date(n.solarDate);if(o.setDate(o.getDate()-c),o.setHours(9,0,0),o>new Date){const d=n.details?.foods?.slice(0,2).map(g=>g.name).join(", ")||"ë§›ìžˆëŠ” ìŒì‹";s.push({id:2e4+i,title:`ê³§ ${n.name}ìž…ë‹ˆë‹¤ ðŸŒ•`,body:`${n.name}ì—ëŠ” ${d}ì„(ë¥¼) ë¨¹ì–´ìš”.`,schedule:{at:o},extra:{type:"holiday",name:n.name},smallIcon:"ic_stat_icon_config_sample"})}})}s.length>0&&(await m.schedule({notifications:s}),console.log(`${s.length}ê°œì˜ ì•Œë¦¼ì´ ì˜ˆì•½ë˜ì—ˆìŠµë‹ˆë‹¤.`))}function D(e){return(window.AppState?.allIngredients||[]).filter(c=>{const a=c.periods||[],n=a.some(d=>d.month===e);let i=e-1;i===0&&(i=12);const o=a.some(d=>d.month===i);return n&&!o})}export{S as initSettingModal,u as loadSettings,p as saveSettings};
