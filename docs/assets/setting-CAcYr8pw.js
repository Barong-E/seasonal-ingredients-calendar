import{L as p}from"./main-CQQ8VjLK.js";import"./style-DGAzWC-q.js";const t={ingredient:{enabled:!1,day:1,time:"09:00"},holiday:{enabled:!1,dDay:3,time:"09:00"}};async function b(){const e=localStorage.getItem("app_settings");if(e){const a=JSON.parse(e);t.ingredient={...t.ingredient,...a.ingredient},t.holiday={...t.holiday,...a.holiday}}return t}async function D(e){t.ingredient=e.ingredient,t.holiday=e.holiday,localStorage.setItem("app_settings",JSON.stringify(t)),await v()}function I(){const e=document.getElementById("settingModal"),a=e.querySelector(".modal__close"),r=e.querySelector(".modal__backdrop"),l=document.getElementById("ingredientNotiToggle"),c=document.getElementById("ingredientNotiDetail"),i=document.getElementById("ingredientNotiDay"),n=document.getElementById("ingredientNotiTime"),o=document.getElementById("holidayNotiToggle"),d=document.getElementById("holidayNotiDetail"),g=document.getElementById("holidayNotiDday"),m=document.getElementById("holidayNotiTime"),u=document.getElementById("saveSettingButton");for(let s=1;s<=31;s++){const h=document.createElement("option");h.value=s,h.textContent=`ë§¤ì›” ${s}ì¼`,i.appendChild(h)}b().then(()=>{l.checked=t.ingredient.enabled,c.style.display=t.ingredient.enabled?"block":"none",i.value=t.ingredient.day,n.value=t.ingredient.time||"09:00",o.checked=t.holiday.enabled,d.style.display=t.holiday.enabled?"block":"none",g.value=t.holiday.dDay,m.value=t.holiday.time||"09:00"}),l.addEventListener("change",s=>{c.style.display=s.target.checked?"block":"none"}),o.addEventListener("change",s=>{d.style.display=s.target.checked?"block":"none"}),u.addEventListener("click",async()=>{const s={ingredient:{enabled:l.checked,day:parseInt(i.value),time:n.value||"09:00"},holiday:{enabled:o.checked,dDay:parseInt(g.value),time:m.value||"09:00"}};await D(s),closeSettingModal(),alert("ì„¤ì •ì´ ì €ìž¥ë˜ê³  ì•Œë¦¼ì´ ì˜ˆì•½ë˜ì—ˆìŠµë‹ˆë‹¤.")});const y=()=>{e.setAttribute("aria-hidden","true"),e.style.display="none",document.body.style.overflow=""};a.addEventListener("click",y),r.addEventListener("click",y),window.openSettingModal=()=>{e.setAttribute("aria-hidden","false"),e.style.display="flex",document.body.style.overflow="hidden"},window.closeSettingModal=y}async function v(){const e=await p.getPending();e.notifications.length>0&&await p.cancel(e);const a=[],r=f(t.ingredient.time,{hours:9,minutes:0}),l=f(t.holiday.time,{hours:9,minutes:0});if(t.ingredient.enabled){const c=t.ingredient.day,i=new Date;for(let n=0;n<12;n++){const o=new Date(i.getFullYear(),i.getMonth()+n,c,r.hours,r.minutes,0);if(o.getMonth()!==(i.getMonth()+n)%12&&o.setDate(0),o<i)continue;const d=o.getMonth()+1,g=w(d);if(g.length>0){const m=g.slice(0,3).map(s=>s.name_ko).join(", "),u=g.length,y=u>3?`${m} ë“± ${u}ê°€ì§€ê°€ ì œì² ì´ì—ìš”.`:`${m}ì´(ê°€) ì œì² ì´ì—ìš”.`;a.push({id:1e4+n,title:`${d}ì›”ì˜ ì œì²  ì‹ìž¬ë£Œ ðŸ¥¦`,body:`${d}ì›”ì—ëŠ” ${y}`,schedule:{at:o},extra:{type:"ingredient",month:d},smallIcon:"ic_stat_icon_config_sample"})}}}if(t.holiday.enabled){const c=t.holiday.dDay;(window.AppState?.holidays||[]).forEach((n,o)=>{if(!n.solarDate)return;const d=new Date(n.solarDate);if(d.setDate(d.getDate()-c),d.setHours(l.hours,l.minutes,0),d>new Date){const g=n.details?.foods?.slice(0,2).map(m=>m.name).join(", ")||"ë§›ìžˆëŠ” ìŒì‹";a.push({id:2e4+o,title:`ê³§ ${n.name}ìž…ë‹ˆë‹¤ ðŸŒ•`,body:`${n.name}ì—ëŠ” ${g}ì„(ë¥¼) ë¨¹ì–´ìš”.`,schedule:{at:d},extra:{type:"holiday",name:n.name},smallIcon:"ic_stat_icon_config_sample"})}})}a.length>0&&(await p.schedule({notifications:a}),console.log(`${a.length}ê°œì˜ ì•Œë¦¼ì´ ì˜ˆì•½ë˜ì—ˆìŠµë‹ˆë‹¤.`))}function w(e){return(window.AppState?.allIngredients||[]).filter(r=>{const l=r.periods||[],c=l.some(o=>o.month===e);let i=e-1;i===0&&(i=12);const n=l.some(o=>o.month===i);return c&&!n})}function f(e,a){if(!e||typeof e!="string")return a;const[r,l]=e.split(":"),c=Number(r),i=Number(l);return Number.isNaN(c)||Number.isNaN(i)?a:{hours:c,minutes:i}}export{I as initSettingModal,b as loadSettings,D as saveSettings};
